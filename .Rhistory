ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2020)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
View(pop_by_rp)
pop_by_rp[ , adjusted_frac := pop_frac + data.table::shift(pop_frac), by = month]
pop_by_rp[is.na(adjusted_frac),adjusted_frac:=pop_frac]
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
#ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = return_period,
color = return_period,
fill = return_period#,
#alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
#ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
levels(pop_by_rp$return_period)
install.packages('forcats')
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period)#,
#alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
#ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
leg_colors<-rev(leg_colors)
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period)#,
#alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
#ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period),
alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period),
alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = rev(c(0.65, 0.50, 0.35, 0.25, 0.15)))+
ggplot2::geom_line(size = 1, alpha = 0.85)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period),
alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = rev(c(0.65, 0.50, 0.35, 0.25, 0.15)))+
ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = adjusted_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period)#,
#alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
# ggplot2::scale_alpha_manual(values = rev(c(0.65, 0.50, 0.35, 0.25, 0.15)))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period)#,
#alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
# ggplot2::scale_alpha_manual(values = rev(c(0.65, 0.50, 0.35, 0.25, 0.15)))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period),
alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = rev(c(0.65, 0.50, 0.35, 0.25, 0.15)))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
leg_colors<-c(
'#9B0039',
'#D44135',
'#FF8D43',
'#FFC754',
'#FFEDA3')
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
rsconnect::setAccountInfo(name='isciences', token='05F7FC175372853B0A3E4F8EAA74A784', secret='U5Vii5mNO8EC7hgOzMT8gSMoJR5nFHUVaCeuJOAr')
rsconnect::deployApp('/Users/jbrin/Documents/packages/TOPSTSCHOOL-module-1-water/nyc_lead/')
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
usa <- httr::GET("https://www.geoboundaries.org/api/current/gbOpen/USA/ADM1/")
usa <- httr::content(usa)
usa <- sf::st_read(usa$gjDownloadURL)
texas <- httr::GET("https://www.geoboundaries.org/api/current/gbOpen/USA/ADM1/")
texas <- httr::content(texas)
texas <- sf::st_read(texas$gjDownloadURL)
texas <- texas[texas$shapeName=="Texas",]
texas_counties <- httr::GET("https://www.geoboundaries.org/api/current/gbOpen/USA/ADM2/")
texas_counties <- httr::content(texas_counties)
texas_counties <- sf::st_read(texas_counties$gjDownloadURL)
texas_counties<-sf::st_intersection(texas_counties, texas)
wsim_gldas<-terra::sds("composite_1mo.nc")
wsim_gldas<-wsim_gldas["deficit"]
keeps<-seq(lubridate::ymd("2011-01-01"), lubridate::ymd("2011-12-01"), by = "month")
wsim_gldas<-wsim_gldas[[terra::time(wsim_gldas) %in% keeps]]
names(wsim_gldas) <- keeps
wsim_gldas <- terra::clamp(wsim_gldas, lower = -50, upper = 0)
terra::plot(wsim_gldas)
# numeric reclassiciation
m <- c(-10, 0, -10,
-20, -10, -20,
-30, -20, -30,
-40, -30, -40,
-50, -40, -50)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
wsim_gldas_num <- terra::classify(wsim_gldas, rclmat, include.lowest=TRUE)
pop_dens<-terra::rast("gpw_v4_population_density_rev11_2010_15_min.tif")
pop_by_rp <-
exactextractr::exact_extract(wsim_gldas_num, texas, function(df) {
df <- data.table::setDT(df)
df <-
data.table::melt(
df,
id.vars = c("shapeISO", "coverage_area", "weight"),
variable.name = "month",
value.name = "return_period")
df<-df[,.(pop_rp = round(sum(coverage_area*weight)/1e6)), by = .(shapeISO, month, return_period)]
df[,total_pop:=sum(pop_rp), by = month]
df[,pop_frac:=pop_rp/total_pop][,total_pop:=NULL]
},
summarize_df = TRUE,
weights = pop_dens,
coverage_area = TRUE,
include_cols = 'shapeISO', progress = FALSE)
pop_by_rp[,month:=lubridate::month(pop_by_rp$month, label = TRUE)]
pop_by_rp<-pop_by_rp[!is.nan(return_period)]
pop_by_rp[,return_period:=as.factor(return_period)]
pop_by_rp[ , adjusted_frac := pop_frac + data.table::shift(pop_frac), by = month]
pop_by_rp[is.na(adjusted_frac),adjusted_frac:=pop_frac]
leg_colors<-c(
'#9B0039',
'#D44135',
'#FF8D43',
'#FFC754',
'#FFEDA3')
leg_colors<-rev(leg_colors)
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = forcats::fct_rev(return_period),
color = forcats::fct_rev(return_period),
fill = forcats::fct_rev(return_period),
alpha = forcats::fct_rev(return_period)
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = rev(c(0.65, 0.50, 0.35, 0.25, 0.15)))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
leg_colors<-leg_colors
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
leg_colors<-leg_colors
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
leg_colors
leg_colors<-rev(leg_colors)
leg_colors
ggplot2::ggplot(pop_by_rp,
ggplot2::aes(x = month,
y = pop_frac,
group = return_period,
color = return_period,
fill = return_period,
alpha = return_period
))+
ggplot2::geom_area(position = 'identity')+
ggplot2::scale_color_manual(values = leg_colors)+
ggplot2::scale_fill_manual(values = leg_colors)+
ggplot2::scale_alpha_manual(values = c(0.65, 0.50, 0.35, 0.25, 0.15))+
# ggplot2::geom_line(size = 0.1)+
ggplot2::ylim(0,1)+
ggplot2::labs(title = "Fraction of Population Under Water Deficits in Texas During 2011",
subtitle = "Categorized by Intensity of Return Period",
x = "",
y = "Fraction of Population",
caption = "Population derived from Gridded Population of the World (2010)",
color = "Return Period", fill = "Return Period", group = "Return Period", alpha = "Return Period")+
ggplot2::theme_minimal()
res(raster)
terra::res(raster)
#add the year and date you want to search for (YYYY-DD, 2022-01)
year_day <- '2024-023'
#add tile code from the map above (written as h00v00)
tile_code <- 'h05v05'
# Primary Server
#API_URL <- paste0('https://nrt3.modaps.eosdis.nasa.gov/api/v2/content/details?products=MCDWD_L3_F3_NRT&archiveSets=61&temporalRanges=')
# if the primary server is down, the secondary server may be available:
API_URL <- paste0('https://nrt4.modaps.eosdis.nasa.gov/api/v2/content/details?products=MCDWD_L3_F3_NRT&archiveSets=61&temporalRanges=')
#pasting together URL and year_day
url <- paste0(API_URL, year_day)
print(url)
# Make the GET request
response <- httr::GET(url)
response
# Check the response status
if (httr::http_status(response)$category == "Success") {
# Parse the response JSON
data <- httr::content(response, as = "text", encoding = "UTF-8")
data_parsed <- jsonlite::fromJSON(data)
#filter for the tile code
content_items <- data_parsed$content[grepl(tile_code, data_parsed$content$name, ignore.case = TRUE), ]
} else {
print("Request failed with status code", httr::http_status(response)$status_code)
}
print(content_items)
download_link <- content_items$downloadsLink
print(download_link)
download_link
raster_df <- stars::read_stars(download_link)
